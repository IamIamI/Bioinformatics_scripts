#A function that can detach packages, use this to resolve conflicts for example between plyr and dplyr
detachAllPackages <- function() {
  basic.packages <- c("package:stats","package:graphics","package:grDevices","package:utils","package:datasets","package:methods","package:base")
  package.list <- search()[ifelse(unlist(gregexpr("package:",search()))==1,TRUE,FALSE)]
  package.list <- setdiff(package.list,basic.packages)
  if (length(package.list)>0)  for (package in package.list) detach(package, character.only=TRUE)
}
detachAllPackages()

#Function to check if package is already installed, if not, installs it. After install it and loads it
install_load <- function(Required_Packages) {
  for(package in Required_Packages){
    if (!package %in% installed.packages()) install.packages(package, character.only = TRUE)
    library(package, character.only = TRUE)
  }
}

# Defining function to draw text boxes
# https://stackoverflow.com/questions/30178954/dynamic-data-point-label-positioning-in-ggmap
draw.rects.modified <- function(d,...){
  if(is.null(d$box.color))d$box.color <- NA
  if(is.null(d$fill))d$fill <- "grey95"
  for(i in 1:nrow(d)){
    with(d[i,],{
      grid.rect(gp = gpar(col = box.color, fill = fill,alpha=0.7),
                vp = viewport(x, y, w, h, "cm", c(hjust, vjust=0.25), angle=rot))
    })
  }
  d
}

# Defining function to determine text box borders
# https://stackoverflow.com/questions/30178954/dynamic-data-point-label-positioning-in-ggmap
enlarge.box.modified <- function(d,...){
  if(!"h"%in%names(d))stop("need to have already calculated height and width.")
  calc.borders(within(d,{
    w <- 0.9*w
    h <- 1.1*h
  }))
}

#my_lon <- c(136.2596827, 137.2923893, 25.03775882925553, 138.252924, 25.03775882925553, 25.03775882925553, 25.03775882925553, 138.252924, 133.2521507, 133.2521507, 135.7681489, 135.7681489, 25.03775882925553, -3.435973, -3.435973, -0.1277583, -0.1277583, 25.03775882925553, 25.03775882925553, -3.435973, 25.03775882925553, 25.03775882925553, -3.533899, -2.094278, 25.03775882925553, 25.03775882925553, -95.712891, 25.03775882925553, 25.03775882925553, 25.03775882925553, 25.03775882925553, 25.03775882925553, -3.0356748, -1.3289821, -1.1581086, 25.03775882925553, 25.03775882925553, -2.4672611, 25.03775882925553, -95.712891, 25.03775882925553, -3.435973, 25.03775882925553, -0.1277583, -0.1277583, 25.03775882925553, -0.1277583, -74.0059728, 4.4970097, -0.1277583, 25.03775882925553, -99.9018131, -90.0489801, 25.03775882925553, 25.03775882925553, 25.03775882925553, -3.7837117, -0.1277583, -3.435973, -0.1277583, -0.1277583, -3.7837117, -1.794472, -86.902298, -3.7837117, -3.435973, -3.435973, 25.03775882925553, 25.03775882925553, 2.213749, -117.6508876, 153.4, 114.1693611, -98.4968724, -98.4968724, 25.03775882925553, 25.03775882925553, -3.7837117, 114.1693611, -95.712891, 25.03775882925553, 25.03775882925553, 25.03775882925553, 25.03775882925553, 25.03775882925553, 25.03775882925553, 25.03775882925553, 25.03775882925553, 25.03775882925553, -106.346771, -95.712891, 25.03775882925553, 25.03775882925553, 25.03775882925553, -2.9326435, -2.9326435, 25.03775882925553, 25.03775882925553, 25.03775882925553, 14.4378005, 138.252924, -85.323214, 25.03775882925553, 114.1693611, 25.03775882925553, 25.03775882925553, -82.9000751, 25.03775882925553, 25.03775882925553, 25.03775882925553, 25.03775882925553, 25.03775882925553, 25.03775882925553, 0.091266, 12.56738, -99.9018131, 114.1693611, -77.0368707, -79.0192997, -95.712891, -90.1994042, -2.9326435, -2.9326435, 132.5509603, 105.318756, 105.318756, 2.213749, 2.213749, 34.851612, -95.3698028, -85.323214, -85.323214, 25.7481511, -85.323214, -85.323214, 25.7481511, 25.7481511, 25.7481511, -94.6858998, -82.9000751, -105.8700901, -73.087749, -94.6858998, -74.0059728, -76.6412712, -74.0059728, -94.6858998, -105.8700901, -120.5542012, -76.6412712, -105.8700901, -105.8700901, 25.7481511, 25.7481511, 25.7481511, 25.7481511, 25.03775882925553, 172.6305589, 104.195397, -2.2426305, 25.03775882925553, 153.4, 25.03775882925553, 25.03775882925553, -95.3698028, -95.3698028, -95.3698028, -95.3698028, -95.3698028, 144.9630576, -79.0192997, -79.0192997, 174.885971, 133.775136, 178.065032, 178.065032, 133.775136, 178.065032, 133.775136, 178.065032, 37.906193, -51.92528, 178.065032, 174.885971, 133.775136, 178.065032, 78.96288, 133.775136, 133.775136, 78.96288, 174.885971, 178.065032, -51.92528, 133.775136, 37.906193, 174.885971, 178.065032, 133.775136, 133.775136, 37.906193, 174.885971, 178.065032, 2.213749, 2.213749, -77.0368707, -95.712891, -51.92528, -51.92528, 133.775136, 133.775136, 76.7794179, -95.3698028, 76.7794179, -95.712891, -1.1743197, -1.1743197, -1.1743197, -1.1743197, 133.775136, -4.2026458, -4.2026458, -4.2026458, 133.775136, 133.775136)
#my_lat <- c(35.2743905, 35.0182505, -70.99701676, 36.204824, -70.99701676, -70.99701676, -70.99701676, 36.204824, 33.5481246, 33.5481246, 35.011564, 35.011564, -70.99701676, 55.378051, 55.378051, 51.5073509, 51.5073509, -70.99701676, -70.99701676, 55.378051, -70.99701676, -70.99701676, 50.718412, 57.149717, -70.99701676, -70.99701676, 37.09024, -70.99701676, -70.99701676, -70.99701676, -70.99701676, -70.99701676, 53.8175053, 54.5704551, 52.9547832, -70.99701676, -70.99701676, 52.6775873, -70.99701676, 37.09024, -70.99701676, 55.378051, -70.99701676, 51.5073509, 51.5073509, -70.99701676, 51.5073509, 40.7127753, 52.1601144, 51.5073509, -70.99701676, 31.9685988, 35.1495343, -70.99701676, -70.99701676, -70.99701676, 52.1306607, 51.5073509, 55.378051, 51.5073509, 51.5073509, 52.1306607, 51.068785, 32.3182314, 52.1306607, 55.378051, 55.378051, -70.99701676, -70.99701676, 46.227638, 34.0633443, -28.016667, 22.3193039, 29.5166169, 29.5166169, -70.99701676, -70.99701676, 52.1306607, 22.3193039, 37.09024, -70.99701676, -70.99701676, -70.99701676, -70.99701676, -70.99701676, -70.99701676, -70.99701676, -70.99701676, -70.99701676, 56.130366, 37.09024, -70.99701676, -70.99701676, -70.99701676, 48.2020471, 48.2020471, -70.99701676, -70.99701676, -70.99701676, 50.0755381, 36.204824, 51.253775, -70.99701676, 22.3193039, -70.99701676, -70.99701676, 32.1656221, -70.99701676, -70.99701676, -70.99701676, -70.99701676, -70.99701676, -70.99701676, 48.432856, 41.87194, 31.9685988, 22.3193039, 38.9071923, 35.7595731, 37.09024, 38.6270025, 48.2020471, 48.2020471, -19.4914108, 61.52401, 61.52401, 46.227638, 46.227638, 31.046051, 29.7604267, 51.253775, 51.253775, 61.92411, 51.253775, 51.253775, 61.92411, 61.92411, 61.92411, 46.729553, 32.1656221, 34.5199402, 41.6032207, 46.729553, 40.7127753, 39.0457549, 40.7127753, 46.729553, 34.5199402, 43.8041334, 39.0457549, 34.5199402, 34.5199402, 61.92411, 61.92411, 61.92411, 61.92411, -70.99701676, -43.5320214, 35.86166, 53.4807593, -70.99701676, -28.016667, -70.99701676, -70.99701676, 29.7604267, 29.7604267, 29.7604267, 29.7604267, 29.7604267, -37.8136276, 35.7595731, 35.7595731, -40.900557, -25.274398, -17.713371, -17.713371, -25.274398, -17.713371, -25.274398, -17.713371, -0.023559, -14.235004, -17.713371, -40.900557, -25.274398, -17.713371, 20.593684, -25.274398, -25.274398, 20.593684, -40.900557, -17.713371, -14.235004, -25.274398, -0.023559, -40.900557, -17.713371, -25.274398, -25.274398, -0.023559, -40.900557, -17.713371, 46.227638, 46.227638, 38.9071923, 37.09024, -14.235004, -14.235004, -25.274398, -25.274398, 30.7333148, 29.7604267, 30.7333148, 37.09024, 52.3555177, 52.3555177, 52.3555177, 52.3555177, -25.274398, 56.4906712, 56.4906712, 56.4906712, -25.274398, -25.274398)
#my_labels <- c("AP014585.1", "AP014596.1", "AP019548.2", "AP017629.1", "AP012335.1", "AP012491.2", "BA000034.2", "AP018337.1", "AP023387.1", "AP023388.1", "AP023389.1", "AP023390.1", "AM295007.1", "LN831034.1", "LR590466.1", "LS483307.1", "LS483320.1", "LS483323.1", "LS483321.1", "LS483335.1", "LS483326.1", "LS483315.1", "LS483322.1", "LS483327.1", "LS483345.1", "LS483330.1", "LS483336.1", "LS483337.1", "LS483333.1", "LS483334.1", "LS483344.1", "LS483352.1", "LS483331.1", "LS483329.1", "LS483340.1", "LS483355.1", "LS483359.1", "LS483338.1", "LS483353.1", "LS483298.1", "LS483521.1", "LR590483.1", "LS483332.1", "LS483357.1", "LS483347.1", "LS483351.1", "LR134284.1", "LS483356.1", "LS483394.1", "LS483520.1", "LS483360.1", "LR134314.1", "LS483379.1", "HG316453.2", "LS483399.1", "LS483389.1", "LS483382.1", "LS483386.1", "LS483384.1", "LS483407.1", "LS483401.1", "LS483432.1", "LS483430.1", "LS483421.1", "LS483414.1", "LS483425.1", "LS483437.1", "LS483442.1", "LS483415.1", "LR031521.1", "LR130236.1", "LR130237.1", "LR130238.1", "LR130239.1", "LR130240.1", "LS483522.1", "LS483391.1", "LS483420.1", "AFRY01000001.1", "CP003068.1", "AE009949.1", "AE014074.1", "CP000003.1", "CP000056.2", "CP000017.2", "CP000259.1", "CP000260.1", "CP000262.1", "CP003901.1", "CP003116.1", "CP003121.1", "AE004092.2", "CP000829.1", "CP006366.1", "CP007240.1", "CP007241.1", "CP007560.1", "CP007561.1", "CP007562.1", "CP007537.1", "CP008695.1", "CP008776.1", "CP008926.1", "CP009612.1", "CP007023.1", "CP007041.1", "CP013840.1", "CP010449.1", "CP010450.1", "CP011069.1", "CP011068.1", "CP011414.1", "CP011415.1", "CP011535.2", "CP013839.1", "CP013838.1", "CP012045.1", "CP014027.2", "CP031770.1", "CP013672.1", "CP014139.1", "CP014278.2", "CP014542.1", "CP015238.2", "CP022354.1", "CP022206.1", "CP020027.1", "CP020082.1", "CP021640.1", "CP023769.1", "CP031640.1", "CP031639.1", "CP031638.1", "CP031637.1", "CP031636.1", "CP031635.1", "CP031634.1", "CP031633.1", "CP032665.1", "CP031632.1", "CP032666.1", "CP031631.1", "CP031630.1", "CP031629.1", "CP031628.1", "CP031627.1", "CP031626.1", "CP031625.1", "CP031624.1", "CP031623.1", "CP031622.1", "CP031621.1", "CP031620.1", "CP031619.1", "CP031618.1", "CP031617.1", "CP028140.1", "CP027771.1", "CP028148.1", "CP028841.1", "CP029694.1", "CP031738.1", "CP033816.1", "CP033767.1", "CP032699.1", "CP033335.1", "CP033336.1", "CP033337.1", "CP032701.1", "CP033621.1", "CP033907.1", "CP033908.1", "CP035455.1", "CP035454.1", "CP035453.1", "CP035452.1", "CP035451.1", "CP035450.1", "CP035449.1", "CP035448.1", "CP035447.1", "CP035446.1", "CP035445.1", "CP035444.1", "CP035443.1", "CP035442.1", "CP035441.1", "CP035440.1", "CP035439.1", "CP035438.1", "CP035437.1", "CP035436.1", "CP035435.1", "CP035434.1", "CP035433.1", "CP035432.1", "CP035431.1", "CP035430.1", "CP035429.1", "CP035428.1", "CP035427.1", "CP035426.1", "CP036530.1", "CP036531.1", "CP044096.1", "CP040997.1", "CP041408.1", "CP041615.1", "CP043530.1", "CP045930.1", "CP047120.1", "CP049187.1", "CP049799.1", "CP051138.1", "CP061134.1", "CP061133.1", "CP061132.1", "CP061131.1", "CP065927.1", "CP067010.1", "CP067009.1", "CP067008.1", "CP070994.1", "CP072112.1")
#my_years <- c(2011, 1994, 2010, 2016, NA, NA, NA, 2017, NA, NA, 2007, 2009, 1952, 1950, 1950, 1937, 1937, 1950, 1950, 1950, 1988, 1974, 1979, 1981, 1927, 1932, 1986, 1974, 1974, 1974, 2007, 1965, 1972, 1972, 1972, 1980, 1981, 1982, 1933, 1951, 1935, 1934, 1992, 1950, 1932, 1950, 1934, 1951, 1966, 1950, 1967, 1918, 1973, NA, 1942, 1969, 2015, 2015, 2015, 2013, 1953, 2015, 1981, 1968, 2015, 2012, 2015, 1952, 1931, 2008, 1994, 1905, 1905, 2010, 2010, 1951, 1931, 2014, 2011, 1986, NA, NA, NA, NA, NA, NA, NA, NA, NA, 2008, NA, NA, NA, NA, 2011, 2009, NA, NA, NA, NA, 2012, 1994, NA, 2011, NA, NA, 2008, NA, NA, 2009, 2010, 1971, 1971, 2009, 1997, 2002, 2012, 2014, NA, 1967, 2012, 2013, 2014, 1990, 1938, 2011, 2009, 2012, 1997, 2017, 1994, 1995, 1995, 1998, 2000, 2000, 2001, 2002, 2005, 2010, 2009, 1999, 2011, 2011, 1998, 2000, 2002, 2006, 2008, 2008, 2008, 2012, 2015, 2011, 2010, 2008, 2016, 2014, 2011, NA, 2011, 2017, 2016, 2016, 2013, 2014, 2013, 2014, 2015, 2011, NA, NA, 2013, 1994, 2006, 2006, 2005, 2006, 2005, 2006, 2007, 2004, 2006, 2014, 1995, 2006, NA, 1997, 2005, NA, 2002, 2006, 2003, 1991, 1998, 2011, 2006, 2005, 1999, 2005, 2014, 2006, 2009, 2010, NA, NA, 1997, 1997, 1988, 2013, 2008, 2018, 2008, 2005, 2001, 2002, 2006, 2008, 2020, 2018, 2019, 2015, 2018, 2020)
my_lon <- c(-61.7745,15.496237,25.3093,98.1753,28.979167,-77.937306,25.466667,42.716994,26.6294444,0.061219,0.170347,-69.3308,17.253729,74.56996,167.216667,5.444314,65.7891667,-2.449429,77.8231,NA,-3.6101,31.2,-99.141569,111.7683,17.46491,-77.696297,25.2667,19.9369,10.6899,10.8464,10.8613,3.2867,-72.545556,9.199843,14.44864,NA,NA)
my_lat <- c(17.0239,44.078822,54.6749,19.5219,25.5,-6.086417,35.183333,43.826357,42.2818611,52.260128,52.196792,-20.488,48.186429,42.86996,-9.95,53.184298,18.0936111,42.468106,49.5222,NA,14.349,29.9,19.431305,46.2841,49.316913,-6.85135,54.6826,50.0594,53.8715,48.2178,48.2333,45.7735,-13.163333,45.450924,50.372859,NA,NA)
my_years <- c(NA,-550,NA,221,-301,1098,-2036.5,-2107,-1755,NA,NA,NA,NA,NA,NA,NA,NA,NA,-670,NA,NA,NA,1438.5,NA,NA,1550,1537.5,NA,NA,NA,NA,-4638.5,NA,NA,NA,NA,NA)
my_labels <- c("GBA012.A0101.SP1.1","NGR006.A0101.SP1.2","SUB002.A0101.SP1.1","BRB003.A0101.SP1.1","DKH001.B0101.SP1.1","JUC003.A0101.SP1.1","HGC003.A0101.SP1.1","KBD002.A0101.SP1.2","BOY003.A0101.SP1.1","OAI007.A0101.SP1.2","HAD008.A0101.SP1.2","PIA002.A0101.SP1.1","IVA009.A0101.SP1.1","ADJ010.A0101.SP1.1","NMU068.A0101.SP1.1","MDM006.A0101.SP1.2","PCA004.A0101.SP1.1","LOG052.A0101.SP1.1","ESZ001.B0101.SP1.1","MOB017.A0101.SP1.1","DOM028.B0101.SP1.1","ABU014.A0101.SP1.1","SJN016.C0101.SP1.1","ULN004.B0101.SP1.1","H3P018.B0101.SP1.1","LDC019.B0101.SP1.1","CIU001.A0102.SP1.1","DMP001.C0101.SP1.1","HGH001.A0102.SP1.1","KLE004.A0102.SP1.1","OOH025.A0102.SP1.1","VTZ015.B0101.SP1.1","MAP037.A0101.SP1.1","SAB004.A0101.SP1.1","VLI025.A0101.SP1.1","XXX001.A161215.SP1.1","XXX001.A16933.SP1.1")

install_load("ggmap")

my_df <- data.frame(my_lat,my_lon,my_labels,my_years)

my_map.data <- get_map(location = "world", 
                    maptype = 'roadmap', zoom = 1)
my_map.data <- get_map("world")
#lat_lon <- geocode(c("Hikone-shi Japan", "Aichi Japan", "NA", "Japan", "NA", "NA", "NA", "Japan", "Kochi Japan", "Kochi Japan", "Kyoto Japan", "Kyoto Japan", "NA", "United Kingdom", "United Kingdom", "London United Kingdom", "London United Kingdom", "NA", "NA", "United Kingdom", "NA", "NA", "Exeter United Kingdom", "Aberdeen United Kingdom", "NA", "NA", "USA", "NA", "NA", "NA", "NA", "NA", "Blackpool United Kingdom", "Stockton United Kingdom", "Nottingham United Kingdom", "NA", "NA", "Telford United Kingdom", "NA", "USA", "NA", "United Kingdom", "NA", "London United Kingdom", "London United Kingdom", "NA", "London United Kingdom", "New York USA", "Leiden Netherlands", "London United Kingdom", "NA", "Texas USA", "Memphis USA", "NA", "NA", "NA", "Wales United Kingdom", "London United Kingdom", "United Kingdom", "London United Kingdom", "London United Kingdom", "Wales United Kingdom", "Salisbury United Kingdom", "Alabama USA", "Wales United Kingdom", "United Kingdom", "United Kingdom", "NA", "NA", "France", "Ontario USA", "Gold Coast Australia", "Hong Kong", "Sydney Australia", "Sydney Australia", "NA", "NA", "Wales United Kingdom", "Hong Kong China", "USA", "NA", "NA", "NA", "NA", "NA", "NA", "NA", "NA", "NA", "Canada", "USA", "NA", "NA", "NA", "Brittany France", "Brittany France", "NA", "NA", "NA", "Prague Czechia", "Japan", "Ontario Canada", "NA", "Hong Kong", "NA", "NA", "Georgia USA", "NA", "NA", "NA", "NA", "NA", "NA", "Alencon France", "Italy", "Texas USA", "Hong Kong", "DC USA", "North Carolina USA", "USA", "St.Louis USA", "Brittany France", "Brittany France", "Northern Territory Australia", "Russia", "Russia", "France", "France", "Israel", "Houston USA", "Ontario Canada", "Ontario Canada", "Finland", "Ontario Canada", "Ontario Canada", "Finland", "Finland", "Finland", "Minnesota USA", "Georgia USA", "New Mexico USA", "Connecticut USA", "Minnesota USA", "New York USA", "Maryland USA", "New York USA", "Minnesota USA", "New Mexico USA", "Oregon USA", "Maryland USA", "New Mexico USA", "New Mexico USA", "Finland", "Finland", "Finland", "Finland", "NA", "Christchurch New Zealand", "China", "Manchester United Kingdom", "NA", "Gold Coast Australia", "NA", "NA", "Houston USA", "Houston USA", "Houston USA", "Houston USA", "Houston USA", "Melbourne Australia", "North Carolina USA", "North Carolina USA", "New Zealand", "Australia", "Fiji", "Fiji", "Australia", "Fiji", "Australia", "Fiji", "Kenya", "Brazil", "Fiji", "New Zealand", "Australia", "Fiji", "NA", "India", "Australia", "Australia", "India", "New Zealand", "Fiji", "Brazil", "Australia", "Kenya", "New Zealand", "Fiji", "Australia", "Australia", "Kenya", "New Zealand", "Fiji", "France", "France", "Washington DC USA", "USA", "Brazil", "Brazil", "Australia", "Australia", "Chandigarh India", "Houston USA", "Chandigarh India", "USA", "England United Kingdom", "England United Kingdom", "England United Kingdom", "England United Kingdom", "Australia", "Scotland United Kingdom", "Scotland United Kingdom", "Scotland United Kingdom", "Australia", "Australia"), output = "latlona")
#write.csv(lat_lon, "write_csv.")

boxes <-
  list("top.bumptwice", "calc.boxes",  "enlarge.box.modified", "draw.rects.modified")

ggmap(get_stamenmap( maptype = c("toner-lite"), bbox = c(left = -180, bottom = -80, right = 179.9999, top = 85), zoom = 3)) +
  geom_point(data = my_df, aes(x = my_lon, y = my_lat, fill = my_years), 
             pch = 21, size = 6) +
  scale_fill_gradient(low="red", high="blue") +
  labs(x = 'Longitude', y = 'Latitude')

